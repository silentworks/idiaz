#!/usr/bin/env php
<?php
date_default_timezone_set('UTC');
require __DIR__ . '/../vendor/autoload.php';

use Symfony\Component\Console\Application;
use DoctrineMigrationsHelper\CommandSet;
use Doctrine\DBAL;

$dbConfig = require __DIR__ . '/../config/database.php';

$connectionParams = $dbConfig['connections'][$dbConfig['default']];

// replace with the mechanism to retrieve DBAL connection in your app
$config = new DBAL\Configuration();
$connection = DBAL\DriverManager::getConnection($connectionParams, $config);

$console = new Application();

$set = new CommandSet($connection);
$set->configuration->setMigrationsNamespace('Idiaz\Migrations');
$set->configuration->setMigrationsDirectory(__DIR__ . '/../src/Migrations');
$set->configuration->registerMigrationsFromDirectory(__DIR__ . '/../src/Migrations');
$console->addCommands($set->getCommands());

$console->run();